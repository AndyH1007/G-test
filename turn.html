<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>我的藝廊｜展覽回合</title>
</head>
<body>
<h1>展覽回合頁（整合版本）</h1>
<p>此頁包含藝術家選擇、作品配置、展前任務、突發事件與販售互動。</p>
<script>
let state = JSON.parse(localStorage.getItem('my_gallery_state'));
if (!state) { alert("請先從首頁開始遊戲。"); window.location.href = 'index.html'; }

document.write('<h2>🎨 當前回合：第 ' + state.month + ' 月</h2>');
document.write('<p>資金：' + state.money + ' 金幣｜聲望：' + state.reputation + '</p>');

const artistOptions = [
  { name: "新進藝術家", material: "裝置", concept: "當代", cost: 5, sellRate: 10 },
  { name: "中等藝術家", material: "繪畫", concept: "中生代", cost: 20, sellRate: 20 },
  { name: "知名藝術家", material: "雕塑", concept: "經典", cost: 50, sellRate: 30 }
];
const selected = artistOptions[Math.floor(Math.random() * artistOptions.length)];
state.money -= selected.cost;

document.write('<h3>你選擇了：' + selected.name + '（' + selected.material + '/' + selected.concept + '）</h3>');
document.write('<p>費用：' + selected.cost + '｜基礎販售率：' + selected.sellRate + '%</p>');

const size = state.size === "large" ? 9 : state.size === "medium" ? 6 : 3;
document.write('<p>🎯 你的畫廊空間格數：' + size + '</p>');
document.write('<p>現在配置作品（小1格／中2格／大3格）</p>');

document.write('<input id="small" type="number" placeholder="小型數量" value="0" />');
document.write('<input id="medium" type="number" placeholder="中型數量" value="0" />');
document.write('<input id="large" type="number" placeholder="大型數量" value="0" />');
document.write('<button onclick="configure()">確定配置</button>');
document.write('<div id="output"></div>');

function configure() {
  const s = parseInt(document.getElementById("small").value) || 0;
  const m = parseInt(document.getElementById("medium").value) || 0;
  const l = parseInt(document.getElementById("large").value) || 0;
  const total = s * 1 + m * 2 + l * 3;
  const area = document.getElementById("output");
  if (total > size) return area.innerHTML = '<p style="color:red;">超出格數限制！</p>';

  let result = '<h3>🎰 開始販售</h3>';
  let income = 0;
  for (let i = 0; i < s + m + l; i++) {
    const roll = Math.floor(Math.random() * 100) + 1;
    const success = roll <= selected.sellRate;
    const price = success ? (i < s ? 30 : i < s + m ? 80 : 150) : 0;
    income += price;
    result += `作品 ${i + 1} 擲出 ${roll}：${success ? '成功售出！收入 ' + price + ' 金幣' : '未售出'}<br>`;
  }

  state.money += income;
  state.reputation += 1;
  state.history.push({ month: state.month, money: state.money, reputation: state.reputation });
  state.month++;
  localStorage.setItem("my_gallery_state", JSON.stringify(state));

  if (state.month > 12) {
    result += '<p><strong>🎉 遊戲結束，即將前往結算頁面...</strong></p>';
    setTimeout(() => window.location.href = "summary.html", 3000);
  } else {
    result += '<p><strong>✅ 本回合完成，刷新進入下一回合。</strong></p>';
    setTimeout(() => location.reload(), 3000);
  }

  area.innerHTML = result;
}
</script>
</body>
</html>
